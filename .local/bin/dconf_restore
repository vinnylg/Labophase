#!/bin/bash
# ~/.local/bin/restore_dconf

BACKUP_FILE="$HOME/.dconf"

if [ ! -f "$BACKUP_FILE" ]; then
    echo "âŒ Arquivo de backup nÃ£o encontrado: $BACKUP_FILE"
    exit 1
fi

# Criar arquivo temporÃ¡rio com estado atual
CURRENT_STATE=$(mktemp)
trap 'rm -f "$CURRENT_STATE"' EXIT
dconf dump / > "$CURRENT_STATE"

# Verificar se hÃ¡ diferenÃ§as
if diff -q "$CURRENT_STATE" "$BACKUP_FILE" >/dev/null; then
    echo "âœ… Nenhuma diferenÃ§a encontrada entre o backup e a configuraÃ§Ã£o atual"
    exit 0
fi

# Mostrar diff interativo
echo "ğŸ” Visualizando diferenÃ§as (saia com :q no vimdiff para continuar)"
vimdiff "$CURRENT_STATE" "$BACKUP_FILE"

# ConfirmaÃ§Ã£o final
read -p "âš ï¸  Deseja aplicar estas alteraÃ§Ãµes? (s/n): " confirm
if [[ ! "$confirm" =~ ^[Ss]$ ]]; then
    echo "âŒ RestauraÃ§Ã£o cancelada"
    exit 0
fi

# Aplicar mudanÃ§as
echo "ğŸ”„ Restaurando configuraÃ§Ãµes..."
dconf load / < "$BACKUP_FILE"
echo "âœ… ConfiguraÃ§Ãµes restauradas com sucesso de: $BACKUP_FILE"